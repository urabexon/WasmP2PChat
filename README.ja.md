# WasmP2PChat ğŸ›°ï¸

Goè£½ã®WebAssemblyï¼ˆWasmï¼‰ã¨WebRTCã‚’åˆ©ç”¨ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶é–“ã§ç›´æ¥ï¼ˆP2Pï¼‰ãƒãƒ£ãƒƒãƒˆãŒã§ãã‚‹ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚  
ãƒãƒƒãƒãƒ¡ã‚¤ã‚­ãƒ³ã‚°ã‚µãƒ¼ãƒã§ç›¸æ‰‹ã‚’æ¢ã—ã€ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°ã‚µãƒ¼ãƒã‚’é€šã˜ã¦æ¥ç¶šæƒ…å ±ã‚’äº¤æ›ã—ãŸå¾Œã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶åŒå£«ãŒç›´æ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€å—ä¿¡ã—ã¾ã™ã€‚

## Summary âœ´ï¸

- **ç›®çš„** ï¼šWasm ã¨ WebRTC ã®åŸºæœ¬çš„ãªé€£æºæ–¹æ³•ã‚’å­¦ã¶ãŸã‚ã®ãƒ‡ãƒ¢
- **æ©Ÿèƒ½** ï¼š
  - ãƒ©ãƒ³ãƒ€ãƒ ã«ç›¸æ‰‹ã‚’æ¢ã—ã¦P2Pæ¥ç¶š
  - ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€å—ä¿¡
- **æƒ³å®šå¯¾è±¡è€…** ï¼šWebRTCã‚„Wasmã®å‹•ä½œç¢ºèª(ä¸­ç´šã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å¯¾è±¡)

## Usage ğŸ§‘â€ğŸ’»
### å¿…è¦ç’°å¢ƒ

- Go 1.24.xï¼ˆWasmå¯¾å¿œï¼‰
- ä»»æ„ã®ãƒ¢ãƒ€ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆChrome / Firefox / Safariï¼‰
- ã‚¿ãƒ¼ãƒŸãƒŠãƒ«3ã¤ä½¿ç”¨
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§å‹•ä½œç¢ºèªæ¨å¥¨(æœ¬ç•ªç’°å¢ƒç­‰ã«ã—ãŸã„æ–¹ã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ãã ã•ã„)

## How chat works ğŸ§

1. WebAssemblyãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ“ãƒ«ãƒ‰
```bash
GOOS=js GOARCH=wasm go build -o main.wasm
cp "$(go env GOROOT)/lib/wasm/wasm_exec.js" ./wasm_exec.js
```

2. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1: é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒèµ·å‹•
```bash
python3 -m http.server 8080
```

3. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2: ãƒãƒƒãƒãƒ¡ã‚¤ã‚­ãƒ³ã‚°ã‚µãƒ¼ãƒèµ·å‹•
```bash
go run cmd/matchmaking/main.go
```

4. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«3: ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°ã‚µãƒ¼ãƒèµ·å‹•
```bash
go run cmd/signaling/main.go
```

5. ãƒ–ãƒ©ã‚¦ã‚¶ã§æ¥ç¶š
- http://localhost:8080 ã‚’2ã¤ã®ã‚¿ãƒ–ã§é–‹ã
- ä¸¡æ–¹ã§STARTã‚’æŠ¼ã™
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ SEND ã§é€å—ä¿¡

## Stack ğŸ› ï¸

- WebAssembly (Wasm)
  - ãƒ–ãƒ©ã‚¦ã‚¶ã§Goãªã©ã®è¨€èªã‚’å®Ÿè¡Œã§ãã‚‹ãƒã‚¤ãƒŠãƒªå½¢å¼
  - é«˜é€Ÿã‹ã¤å‹å®‰å…¨ã€Goã®ä¸¦è¡Œå‡¦ç†ã‚’æ´»ç”¨å¯èƒ½
- WebRTC
  - ãƒ–ãƒ©ã‚¦ã‚¶åŒå£«ã‚’ç›´æ¥ã¤ãªããƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡æŠ€è¡“
  - éŸ³å£°ã€æ˜ åƒã€ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã«å¯¾å¿œ
- DataChannel
  - WebRTCã®ãƒ‡ãƒ¼ã‚¿é€šä¿¡æ©Ÿèƒ½
  - ãƒ†ã‚­ã‚¹ãƒˆã‚„ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥é€å—ä¿¡
- P2Pé€šä¿¡
  - ã‚µãƒ¼ãƒãƒ¼ã‚’çµŒç”±ã›ãšã€ç«¯æœ«åŒå£«ãŒç›´æ¥ã‚„ã‚Šå–ã‚Š
  - ã‚µãƒ¼ãƒãƒ¼è² è·ã‚’è»½æ¸›ã—ã€é…å»¶ã‚’æœ€å°åŒ–

## Benefits and limitations ğŸ‘©â€âš•ï¸

```bash
[Browser A] --WebSocket--> [Matchmaking Server] <--WebSocket-- [Browser B]
       â†“ RoomIDé€šçŸ¥                             â†“
[Browser A] --WebSocket--> [Signaling Server] <--WebSocket-- [Browser B]
       â†“ æ¥ç¶šæƒ…å ±äº¤æ›ï¼ˆSDP, ICEå€™è£œï¼‰
[Browser A] <==== WebRTC DataChannel (P2P) ====> [Browser B]
```

1. ãƒãƒƒãƒãƒ¡ã‚¤ã‚­ãƒ³ã‚°
    - æ¥ç¶šã—ã¦ããŸãƒ¦ãƒ¼ã‚¶ãƒ¼åŒå£«ã‚’ãƒšã‚¢ã«ã—ã¦Room IDã‚’ç™ºè¡Œ

2. ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°
    - WebRTCæ¥ç¶šã«å¿…è¦ãªSDPã‚„ICEå€™è£œã‚’äº¤æ›

3. P2Pé€šä¿¡
    - æ¥ç¶šç¢ºç«‹å¾Œã¯ãƒ–ãƒ©ã‚¦ã‚¶é–“ã§ç›´æ¥ãƒ‡ãƒ¼ã‚¿é€å—ä¿¡

## Troubleshooting â›“ï¸â€ğŸ’¥

| ç—‡çŠ¶          | åŸå›              | å¯¾å‡¦        |
| ----------- | -------------- | --------- |
| æ¥ç¶šã§ããªã„      | ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°ã‚µãƒ¼ãƒæœªèµ·å‹•   | ã‚¿ãƒ¼ãƒŸãƒŠãƒ«3ã‚’ç¢ºèª |
| ç›¸æ‰‹ãŒè¦‹ã¤ã‹ã‚‰ãªã„   | ãƒãƒƒãƒãƒ¡ã‚¤ã‚­ãƒ³ã‚°ã‚µãƒ¼ãƒæœªèµ·å‹• | ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2ã‚’ç¢ºèª |
| ãƒ­ãƒ¼ã‚«ãƒ«ä»¥å¤–ã§å‹•ã‹ãªã„ | NATè¶Šãˆä¸å¯        | TURNã‚µãƒ¼ãƒè¿½åŠ  |

## Reference ğŸ”–

- [https://webrtc.org/?hl=ja](https://webrtc.org/?hl=ja)
- [https://developer.mozilla.org/ja/docs/WebAssembly/Guides/Concepts](https://developer.mozilla.org/ja/docs/WebAssembly/Guides/Concepts)
- [https://github.com/OpenAyame/ayame](https://github.com/OpenAyame/ayame)